#!/usr/bin/env ruby

# Most of the code in here is taken from the following page:
# https://github.com/rubyists/ebeats-implementations/blob/master/ruby/ebeats.rb
require 'time'
require 'optparse'

option_parser = OptionParser.new do |opt|
  opt.banner  = <<-TXT.strip
Converts the current or specified time to ebeats.

Usage:
  ebeats [TIME] [OPTIONS]

Example:
  ebeats 12:30
  TXT

  opt.summary_indent = '  '

  opt.separator "\nOptions:\n"

  opt.on('-h', '--help', 'Shows this help message') do
    puts option_parser
    exit
  end
end

option_parser.parse!

# Convert the time to ebeats
if ARGV[0] and !ARGV[0].empty?
  time = Time.strptime(ARGV[0], '%H:%M').utc.to_a
else
  time = Time.now.utc.to_a
end

ratio = Rational(1000, 24 * 60 * 60), Rational(1000, 24 * 60), Rational(1000, 24)

puts "@%.2f" % time[0,3].zip(ratio).map { |t,r| t * r }.inject(:+)
